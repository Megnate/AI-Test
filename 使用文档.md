# Vue 2.7 到 Vue 3 迁移 Agent 使用文档

## 文档概述

本文档说明如何在Dify平台中使用Vue 2.7到Vue 3迁移Agent，帮助您将基于class装饰器语法的Vue 2.7项目升级到Vue 3的Composition API (setup语法)形式。

## 前置准备

### 1. 环境要求
- 已部署Dify平台（内网环境）
- 已创建Dify Agent应用
- 了解Vue 2.7和Vue 3的基本语法差异

### 2. 项目信息
- 项目基于Vue 2.7 + 装饰器 + Vuex3
- 使用TypeScript
- 包含大量class组件和this引用
- 使用Vue实例方法（$confirm、$bus、$store、$emit、$set等）
- 包含自定义指令（如v-canClick）

## 在Dify中配置Agent

### 步骤1：创建Agent应用

1. 登录Dify平台
2. 进入"应用"页面，点击"创建应用"
3. 选择"Agent"类型
4. 填写应用名称（如：Vue迁移助手）

### 步骤2：配置提示词

1. 在Agent配置页面，找到"提示词"或"Prompt"设置
2. 将`dify-agent-prompt.md`文件中的完整内容复制到提示词输入框
3. 保存配置

### 步骤3：配置模型参数（可选）

建议配置：
- **Temperature**: 0.1-0.3（较低温度，确保转换准确性）
- **Max Tokens**: 4000-8000（根据文件大小调整）
- **Top P**: 0.9

### 步骤4：添加工具（可选）

如果需要Agent能够读取文件，可以添加：
- 文件读取工具
- 代码分析工具

## 使用方法

### 方法一：单文件转换

**输入格式：**
```
请帮我将以下Vue 2.7文件转换为Vue 3 setup语法：

[粘贴完整的.vue或.ts文件内容]
```

**示例：**
```
请帮我将以下Vue 2.7文件转换为Vue 3 setup语法：

<template>
  <div>
    <button @click="handleClick">{{ count }}</button>
  </div>
</template>

<script lang="ts">
import { Component, Vue } from 'vue-property-decorator'

@Component
export default class MyComponent extends Vue {
  count = 0
  
  handleClick() {
    this.count++
    this.$emit('update', this.count)
  }
}
</script>
```

### 方法二：文件夹批量转换

**输入格式：**
```
请帮我将以下文件夹中的所有Vue文件转换为Vue 3 setup语法：

[文件1内容]
---
[文件2内容]
---
[文件3内容]
```

**提示：** 如果文件较多，建议分批处理，每次处理3-5个文件。

### 方法三：指定转换规则

如果需要对特定部分进行特殊处理，可以添加说明：

```
请帮我将以下文件转换为Vue 3，特别注意：
1. $confirm需要使用Element Plus的ElMessageBox
2. $bus需要使用mitt库
3. Store需要转换为Pinia格式
4. 保持所有业务逻辑不变

[文件内容]
```

## 转换后处理

### 1. 检查转换结果

Agent会返回：
- ✅ 完整的转换后代码
- ✅ 主要变更点列表
- ✅ 需要注意的事项
- ✅ 依赖说明

### 2. 创建必要的组合函数

根据Agent的提示，创建缺失的组合函数：

**useConfirm.ts** (如果使用Element Plus)
```typescript
import { ElMessageBox, ElMessageBoxOptions } from 'element-plus'

export function useConfirm() {
  return (message: string, title: string, options?: ElMessageBoxOptions) => {
    return ElMessageBox.confirm(message, title, options)
  }
}
```

**useEventBus.ts** (如果使用mitt)
```typescript
import mitt from 'mitt'

type Events = {
  [key: string]: any
}

const emitter = mitt<Events>()

export function useEventBus() {
  return {
    on: emitter.on.bind(emitter),
    emit: emitter.emit.bind(emitter),
    off: emitter.off.bind(emitter)
  }
}
```

### 3. 安装依赖

根据Agent的提示，安装必要的依赖：

```bash
npm install pinia
npm install mitt
npm install element-plus  # 如果使用Element Plus
```

### 4. 注册自定义指令

确保自定义指令在Vue 3中正确注册：

**main.ts**
```typescript
import { createApp } from 'vue'
import { vCanClick } from '@/directives/canClick'

const app = createApp(App)
app.directive('canClick', vCanClick)
app.mount('#app')
```

### 5. 配置Pinia Store

将Vuex 3的store转换为Pinia格式：

**stores/user.ts** (示例)
```typescript
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', {
  state: () => ({
    userName: ''
  }),
  getters: {
    // ...
  },
  actions: {
    async fetchUser(id: string) {
      // ...
    }
  }
})
```

## 常见问题处理

### Q1: Agent转换后的代码有语法错误

**解决方案：**
1. 检查是否所有import语句都正确
2. 检查类型定义是否完整
3. 检查是否有遗漏的响应式引用（.value）
4. 手动修复明显的语法错误

### Q2: 某些Vue实例方法无法转换

**解决方案：**
1. 查看Agent的"需要注意的事项"部分
2. 根据提示创建对应的组合函数
3. 参考本文档的"创建必要的组合函数"部分

### Q3: 转换后功能异常

**解决方案：**
1. 对比转换前后的逻辑是否一致
2. 检查响应式数据的访问方式（ref需要.value）
3. 检查生命周期钩子的执行时机
4. 使用Vue DevTools调试

### Q4: 自定义指令不工作

**解决方案：**
1. 确保指令在main.ts中正确注册
2. 检查指令的Vue 3兼容性
3. 参考Vue 3指令API文档更新指令实现

### Q5: Store转换不完整

**解决方案：**
1. 手动将Vuex 3的store转换为Pinia格式
2. 确保所有getter和action都正确转换
3. 检查模块化store的命名空间处理

## 最佳实践

### 1. 分批处理
- 不要一次性转换整个项目
- 建议按模块或功能分批转换
- 每次转换后测试功能是否正常

### 2. 版本控制
- 使用Git管理代码
- 为每次转换创建独立分支
- 转换完成后进行代码审查

### 3. 测试验证
- 转换后立即进行功能测试
- 使用单元测试验证逻辑正确性
- 进行集成测试确保模块间协作正常

### 4. 代码审查
- 检查转换后的代码质量
- 确保符合Vue 3最佳实践
- 优化性能和可维护性

### 5. 文档更新
- 更新项目文档
- 记录迁移过程中的问题和解决方案
- 更新团队开发规范

## 转换检查清单

转换完成后，请检查以下项目：

- [ ] 所有class组件已转换为setup语法
- [ ] 所有this引用已消除
- [ ] Props和Emits类型定义完整
- [ ] 所有Vue实例方法已替换
- [ ] Vuex已转换为Pinia
- [ ] 生命周期钩子已更新
- [ ] 自定义指令已正确注册
- [ ] 所有import语句完整
- [ ] 代码无语法错误
- [ ] 功能测试通过
- [ ] 类型检查通过（如果使用TypeScript）

## 迁移进度跟踪

建议使用以下表格跟踪迁移进度：

| 文件/模块 | 状态 | 转换日期 | 测试状态 | 备注 |
|---------|------|---------|---------|-----|
| components/User.vue | ✅ 已完成 | 2024-01-01 | ✅ 通过 | - |
| views/Home.vue | 🔄 进行中 | - | - | 需要处理$bus |
| stores/user.ts | ⏳ 待处理 | - | - | - |

**状态说明：**
- ✅ 已完成：已转换并测试通过
- 🔄 进行中：正在转换或测试中
- ⏳ 待处理：尚未开始转换
- ❌ 有问题：转换后存在问题，需要修复

## 技术支持

如果在使用过程中遇到问题：

1. 检查本文档的"常见问题处理"部分
2. 查看Agent返回的"需要注意的事项"
3. 参考Vue 3官方迁移指南
4. 检查项目依赖和配置

## 附录

### 相关资源
- [Vue 3 官方文档](https://cn.vuejs.org/)
- [Vue 3 迁移指南](https://v3-migration.vuejs.org/zh/)
- [Pinia 文档](https://pinia.vuejs.org/zh/)
- [Composition API 文档](https://cn.vuejs.org/guide/extras/composition-api-faq.html)

### 常用组合函数模板

更多组合函数模板请参考项目中的`composables`目录。

---

**文档版本**: 1.0  
**最后更新**: 2024-01-01  
**维护者**: 您的团队

